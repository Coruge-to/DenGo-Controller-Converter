# DenGo-Controller-Converter (GUI Edition)

「電車でGO! コントローラー (SLPH-00501)」を、USB変換アダプタ「ELECOM JC-PS201USV」経由でPCに接続し、「JR東日本トレインシミュレータ (JRETS)」のマスコンとして使用するためのPython製コンバーターです。

## 特徴

* **GUIによる視覚化 (New!)**
    * **電気指令式モード**: 現在のノッチ・ブレーキ段数をバーゲージで直感的に表示します。
    * **自動空気ブレーキモード**: 独特のハンドル操作（運転・重なり・常用・非常）を、**高精細なポリゴン描画による円弧ゲージ**で再現。視覚的に現在の弁の状態を把握できます。
* **リアルタイム設定変更 (New!)**
    * 画面上のボタンをクリックすることで、起動したまま「モード切替」や「最大ノッチ数の変更」が可能です。
* **完全同期ロジック**
    マスコン・ブレーキの物理的な位置とゲーム内の段数を完全に同期させます。
* **ノイズ除去フィルタ**
    コントローラー特有の接点チャタリングや、移動中の一瞬の信号飛び（ノイズ）を独自のアルゴリズムでカットし、誤動作を防ぎます。
* **2つのモード搭載**
    * **Mode 1: 電気指令式**: E233系など
    * **Mode 2: 自動空気ブレーキ**: キハ54系など

> [!NOTE]
> **※用語に関する注釈**  
> 本ツールではモード区分として「電気指令式」「自動空気ブレーキ」という呼称を用いていますが、これらは**ゲーム内での挙動（応答性重視か、込め・重なり操作重視か）を区別するための便宜的な呼称**です。  
> 実車のブレーキシステムの厳密な定義や分類（電磁直通、電磁自動など）に準拠したものではありません。

> [!WARNING]
> **重要な仕様：勾配起動について**  
> 本ツールは入力の安定性を最優先するため、**「ブレーキが少しでも入っている状態では、マスコン出力は強制的に『切 (N)』になる」** 仕様としています。  
> そのため、**ブレーキを掛けたままノッチを入れて発進する「勾配起動」操作はできない仕様です。**  
> ブレーキを解除した瞬間に、現在位置のノッチが一気に入ります。

## 必要要件

* Python 3.x
* 以下のライブラリ
    * `pygame` (GUI描画用)
    * `pydirectinput` (キーボード入力送信)

## インストール方法

必要なライブラリをインストールします。

```bash
pip install pygame pydirectinput
```

## 使い方

1. **PCにコントローラーを接続します。**

2. **変換スクリプトの実行**
   スクリプトを実行すると、GUIウィンドウが立ち上がります。

   ```bash
   python converter.py
   ```

3. **画面上での設定 (GUI)**
   マウス操作で設定を変更できます。
   * **モード切替**: 左上のボタンで「電気指令式」と「自動空気ブレーキ」を切り替えます。
   * **段数設定**: 「▲」「▼」ボタンで、車両に合わせた最大ノッチ数・ブレーキ段数を調整します。

4. **ゲーム開始**
   このGUIウィンドウを表示したまま（またはバックグラウンドで動作させたまま）、ゲーム (JRETS) を起動し、運転を開始します。
   ※ ウィンドウがアクティブでなくても入力は送信されますが、最小化は推奨しません。

## キーアサイン (デフォルト設定)

本ツールは以下のキーをゲームに送信します。JRETS側のキーコンフィグが初期状態であることを確認してください。

| カテゴリ | 操作 | キー | 動作概要 |
| :--- | :--- | :---: | :--- |
| **マスコン** | 進段 (加速) | `z` | ノッチを上げる |
| | 減段 (減速) | `a` | ノッチを下げる |
| | 切 (N) | `s` | 一発でノッチオフ (切位置に戻す) |
| **ブレーキ** | 緩解/運転 | `m` | ブレーキを緩める |
| | ブレーキ強 | `.` | ブレーキを強める (>) |
| | ブレーキ弱 | `,` | ブレーキを弱める (<) |
| | 非常 | `/` | 非常ブレーキ |
| **その他** | SELECT | `Enter` | 電笛など |
| | START | `Backspace` | 空笛など |

## 免責事項

* 本ツールは非公式の個人制作物です。JR東日本、株式会社タイトー、エレコム株式会社などの企業とは一切関係ありません。
* 本ツールを使用したことによるハードウェアの故障、データの破損、その他いかなる損害についても、作者は一切の責任を負いません。自己責任でご使用ください。
* **無改造での二次配布禁止**  
本リポジトリのリリースに含まれるバイナリ（exeファイル）を、一切の改変を加えずにそのまま他所で再配布することは禁止します。  
本ソースコードを元に、新しい機能（UIの変更、対応コントローラーの追加など）を付加したものを公開・配布することは大歓迎です。その際は、本リポジトリへのリンクを記載していただけると幸いです。

## Author

Coruge-to