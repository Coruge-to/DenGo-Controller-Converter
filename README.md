# DenGo-Controller-Converter

「電車でGO! コントローラー (SLPH-00501)」を、USB変換アダプタ「ELECOM JC-PS201USV」経由でPCに接続し、「JR東日本トレインシミュレータ (JRETS)」のマスコンとして使用するためのPython製コンバーターです。

## 特徴

* **完全同期ロジック**
    * マスコン・ブレーキの物理的な位置とゲーム内の段数を完全に同期させます。
* **ノイズ除去フィルタ**
    * 古いコントローラー特有の接点チャタリングや、移動中の一瞬の信号飛び（ノイズ）を独自のアルゴリズムでカットし、誤動作を防ぎます。
* **爆速レスポンス**
    * 入力判定を極限までチューニングし、ラグを感じさせない操作感を実現しました。
* **2つのモード搭載**
    * **Mode 1: 電気指令式風**: 高速なレスポンス重視。キビキビ動きます。
    * **Mode 2: 自動空気ブレーキ風**: 「重なり」「常用」の判定を厳密に行い、独特の操作感を再現します。

> [!NOTE]
> **※用語に関する注釈**
> 本ツールではモード区分として「電気指令式」「自動空気ブレーキ」という呼称を用いていますが、これらは**ゲーム内での挙動（応答性重視か、込め・重なり操作重視か）を区別するための便宜的な呼称**です。
> 実車のブレーキシステムの厳密な定義や分類（電磁直通、電磁自動など）に準拠したものではありません。「本来の名称とは異なる」といった用語定義に関するご指摘はお受けできません。

> [!WARNING]
> **重要な仕様：勾配起動について**
> 本ツールは入力の安定性を最優先するため、**「ブレーキが少しでも入っている状態では、マスコン出力は強制的に『切 (N)』になる」** 仕様としています。
> そのため、**ブレーキを掛けたままノッチを入れて発進する「勾配起動」操作はできない仕様です**
> ブレーキを解除した瞬間に、現在位置のノッチが一気に入ります。

## ファイル構成

* `converter.py`: メインの変換プログラムです。
* `test.py`: 入力テスト用プログラムです。コントローラーの認識確認や、ビットパターンのデバッグに使用します。

## 必要要件

* Python 3.x
* 以下のライブラリ
    * `pygame`
    * `pydirectinput`

## インストール方法

必要なライブラリを一括でインストールします。

```bash
pip install -r requirements.txt
```

## 使い方

1. **PCにコントローラーを接続します。**

2. **動作確認（推奨）**
   まずは動作確認のため、テストスクリプトを実行することをお勧めします。
   画面に入力状態が表示され、ボタン押下に合わせて反応すればOKです。

   ```bash
   python test.py
   ```

3. **メインスクリプトの実行**
   メインの変換スクリプトを実行します。

   ```bash
   python converter.py
   ```

4. **モード選択**
   起動後、コンソールでモードを選択してください。
    * `1`: 電気指令式 (E233系など / レスポンス重視)
    * `2`: 自動空気ブレーキ (キハ54など / 重なり位置の保持重視)

5. **ゲーム開始**
   このコンソールウィンドウをアクティブにしたまま、ゲーム (JRETS) を起動し、運転を開始します。

## キーアサイン (デフォルト設定)

本ツールは以下のキーをゲームに送信します。JRETS側のキーコンフィグが初期状態であることを確認してください。

| カテゴリ | 操作 | キー | 動作概要 |
| :--- | :--- | :---: | :--- |
| **マスコン** | 進段 (加速) | `z` | ノッチを上げる |
| | 減段 (減速) | `a` | ノッチを下げる |
| | 切 (N) | `s` | 一発でノッチオフ (切位置に戻す) |
| **ブレーキ** | 緩解/運転 | `m` | ブレーキを緩める |
| | ブレーキ強 | `.` | ブレーキを強める (>) |
| | ブレーキ弱 | `,` | ブレーキを弱める (<) |
| | 非常 | `/` | 非常ブレーキ |
| **その他** | SELECT | `Enter` | 警笛など |
| | START | `Backspace` | 抑速/定速など |

## 免責事項

* 本ツールは非公式の個人制作物です。JR東日本、株式会社タイトー、エレコム株式会社とは一切関係ありません。
* 本ツールを使用したことによるハードウェアの故障、データの破損、その他いかなる損害についても、作者は一切の責任を負いません。自己責任でご使用ください。

## Author

Coruge-to